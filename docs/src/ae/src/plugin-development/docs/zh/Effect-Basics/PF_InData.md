---
title: PF_InData
order: 5
category:
  - AE 插件开发
---

# PF_InData

After Effects 使用`PF_InData`来交流系统、项目、层和音频信息。这个结构在每个命令选择器被发送到插件之前被更新。

只在特定的[PF_Cmds](command-selectors.html)中有效的字段被指出。

另外，不用担心；虽然`PF_InData`大得令人生畏，但你不需要记住每个成员的用途；你会在某些时候使用一些字段。

## PF_InData Members

| **Name**                                                       | **Description**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| -------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `inter`                                                        | Callbacks used for user interaction, adding parameters,checking whether the user has interrupted the effect, displaying a progress bar, and obtaining source frames and parameter values at times other than the current time being rendered<br />This very useful function suite is described in [Interaction Callback Functions](../effect-details/interaction-callback-functions.html#effect-details-interaction-callback-functions).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `utils`                                                        | Graphical and mathematical callbacks. This pointer is defined at all times.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `effect_ref`                                                   | Opaque data that must be passed to most of the various callback routines<br />After Effects uses this to identify your plug-in.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `quality`                                                      | The current quality setting, either `PF_Quality_HI` or `PF_Quality_LO`<br />Effects should perform faster in LO, and more accurately in HI<br />The graphics utility callbacks perform differently between LO and HI quality; so should your effect!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| This field is defined during all frame and sequence selectors. |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `version`                                                      | Effects specification version, Indicate the version you need to run successfully during `PF_Cmd_GLOBAL_SETUP`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `serial_num`                                                   | The serial number of the invoking application.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `appl_id`                                                      | The identifier of the invoking application<br />If your plug-in is running in After Effects, `appl_id` contains the application creator code ‘FXTC’<br />If it is running in [Premiere Pro &amp; Other Hosts](../ppro/ppro.html#ppro-ppro) it will be ‘PrMr’<br />Use this to test whether your plug-in, licensed for use with one application, is being used with another.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `num_params`                                                   | Input parameter count.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `what_cpu`                                                     | Under macOS this contains the Gestalt value for CPU type (see Inside Macintosh, volume 6). Undefined on Windows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `what_fpu`                                                     | Under macOS this contains the Gestalt value for FPU type<br />Undefined on Windows.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `current_time`                                                 | The time of the current frame being rendered, valid during[PF_Cmd_RENDER](command-selectors.html#effect-basics-command-selectors-frame-selectors)<br />This is the current time in the layer, not in any composition<br />If a layer starts at other than time 0 or is time-stretched, layer time and composition time are distinct<br />The current frame number is `current_time` divided by `time_step`<br />The current time in seconds is `current_time` divided by time_scale<br />To handle time stretching, composition frame rate changes, and time remapping, After Effects may ask effects to render at non-integral times (between two frames)<br />Be prepared for this; don’t assume that you’ll only be asked for frames on frame boundaries<br />NOTE: As of CS3 (8.0), effects may be asked to render at negative current times. Deal!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `time_step`                                                    | The duration of the current source frame being rendered<br />In several situations with nested compositions, this source frame duration may be different than the time span between frames in the layer (`local_time_step`)<br />This value can be converted to seconds by dividing by time_scale<br />When calculating other source frame times, such as for [PF_CHECKOUT_PARAM](../effect-details/interaction-callback-functions.html#effect-details-interaction-callback-functions-interaction-callbacks), use this value rather than `local_time_step`<br />Can be negative if the layer is time-reversed. Can vary from one frame to the next if time remapping is applied on a nested composition<br />Can differ from local_time_step when source material is stretched or remapped in a nested composition<br />For example, this could occur when an inner composition is nested within an outer composition with a different frame rate, or time remapping is applied to the outer composition<br />This value will be 0 during [PF_Cmd_SEQUENCE_SETUP](command-selectors.html#effect-basics-command-selectors-sequence-selectors) if it is not constant for all frames<br />It will be set correctly during `PF_Cmd_FRAME_SETUP` and `PF_Cmd_FRAME_SETDOWN` selectors<br />WARNING: This can be zero, so check it before you divide. |
| `total_time`                                                   | Duration of the layer<br />If the layer is time-stretched longer than 100%, the value will be adjusted accordingly; but if the layer is time-stretched shorter, the value will not be affected<br />If time remapping is enabled, this value will be the duration of the composition<br />This value can be converted to seconds by dividing by `time_scale`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `local_time_step`                                              | Time difference between frames in the layer<br />Affected by any time stretch applied to a layer<br />Can be negative if the layer is time-reversed<br />Unlike `time_step`, this value is constant from one frame to the next<br />This value can be converted to seconds by dividing by `time_scale`<br />For a step value that is constant over the entire frame range of the layer, use `local_time_step`, which is based on the composition’s framerate and layer stretch.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `time_scale`                                                   | The units per second that `current_time`, `time_step`, `local_time_step` and `total_time` are in<br />If `time_scale` is 30, then the units of `current_time`, `time_step`, `local_time_step` and `total_time` are in 30ths of a second<br />The `time_step` might then be 3, indicating that the sequence is actually being rendered at 10 frames per second. `total_time` might be 105, indicating that the sequence is 3.5 seconds long.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `field`                                                        | Valid only if[PF_OutFlag_PIX_INDEPENDENT](PF_OutData.html#effect-basics-pf-outdata-pf-outflags) was set during [PF_Cmd_GLOBAL_SETUP](command-selectors.html#effect-basics-command-selectors-global-selectors)<br />Check this field to see if you can process just the upper or lower field.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `shutter_angle`                                                | Motion blur shutter angle. Values range from 0 to 1, which represents 360 degrees<br />Will be zero unless motion blur is enabled and checked for the target layer<br />`shutter_angle == 180` means the time interval between `current_time` and `current_time + 1/2 time_step`<br />Valid only if [PF_OutFlag_I_USE_SHUTTER_ANGLE](PF_OutData.html#effect-basics-pf-outdata-pf-outflags) was set during [PF_Cmd_GLOBAL_SETUP](command-selectors.html#effect-basics-command-selectors-global-selectors)<br />See the section on [Motion Blur](../effect-details/motion-blur.html#effect-details-motion-blur) for details on how to implement motion blur in your effect.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `width`                                                        | Dimensions of the source layer, which are not necessarily the same as the width and height fields in the input image parameter<br />Buffer resizing effects can cause this difference. Not affected by downsampling.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `height`                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `extent_hint`                                                  | The intersection of the visible portions of the input and output layers; encloses the composition rectangle transformed into layer coordinates<br />Iterating over only this rectangle of pixels can speed your effect dramatically. See [extent_hint Usage] later in this chapter regarding proper usage.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `output_origin_x`                                              | The origin of the output buffer in the input buffer. Non-zero only when the effect changes the origin.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `output_origin_y`                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `downsample_x`                                                 | Point control parameters and layer parameter dimensions are automatically adjusted to compensate for a user telling After Effects to render only every nth pixel<br />Effects need the downsampling factors to interpret scalar parameters representing pixel distances in the image (like sliders)<br />For example, a blur of 4 pixels should be interpreted as a blur of 2 pixels if the downsample factor is 1/2 in each direction (downsample factors are represented as ratios.) Valid only during <br /> - [PF_Cmd_SEQUENCE_SETUP](command-selectors.html#effect-basics-command-selectors-sequence-selectors),<br />[PF_Cmd_SEQUENCE_RESETUP](command-selectors.html#effect-basics-command-selectors-sequence-selectors),<br />[PF_Cmd_FRAME_SETUP](command-selectors.html#effect-basics-command-selectors-frame-selectors),<br />[PF_Cmd_RENDER](command-selectors.html#effect-basics-command-selectors-frame-selectors)                                                                                                                                                                                                                                                                                                                                                                                                                |
| `downsample_y`                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `pixel_aspect_ratio`                                           | Pixel aspect ratio (width over height).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `in_flags`                                                     | Unused.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `global_data`                                                  | Data stored by your plug-in during other selectors. Locked and unlocked by After Effects before and after calling the plug-in.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `sequence_data`                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `frame_data`                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `start_sampL`                                                  | Starting sample number, relative to the start of the audio layer.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `dur_sampL`                                                    | Duration of audio, expressed as the number of samples. Audio-specific.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `total_sampL`                                                  | Samples in the audio layer; equivalent to total_time expressed in samples.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `src_snd`                                                      | PF_SoundWorld describing the input sound. Audio-specific.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `pica_basicP`                                                  | Pointer to the PICA Basic suite, used to acquire other suites.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `pre_effect_source_origin_x`                                   | Origin of the source image in the input buffer. Valid only when sent with a frame selector.<br />Non-zero only if one or more effects that preceded this effect on the same layer resized the output buffer and moved the origin.<br />Check for both the resize and the new origin to determine output area.<br />This is useful for effects which have implicit spatial operations (other than point controls), like flipping a file around an image’s center.<br />NOTE: Checked-out point parameters are adjusted for the pre-effect origin at the current time, not the time being checked out.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `pre_effect_source_origin_y`                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `shutter_phase`                                                | Offset from frame time to shutter open time as a percentage of a frame duration.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

## extent_hint Usage

::: tip

对于[SmartFX](../smartfx/smartfx.html)来说，提示矩形更有效...也更复杂...。
:::
使用`extent_hint`来处理那些需要输出的像素；这是你能做的最简单的优化之一。

通过设置[PF_OutFlag_USE_OUTPUT_EXTENT](PF_OutData.html) ，告诉 After Effects 使用`in_data>extent_hint'。 html)(#effect-basics-pf-outdata)中，在[PF_Cmd_GLOBAL_SETUP](command-selectors.html)(#effect-basics-command-selectors-global-selectors)(以及你的 PiPL 中)。

在测试 "extent_hint "代码之前，从偏好菜单中禁用缓存，这样 After Effects 就会在你的合成发生变化时渲染你的效果。

否则，缓存机制会掩盖你的插件的输出(可能不正确)。

在合成中移动图层，使它被裁剪。`output>extent_hint`是图层在合成中可见的部分。

给你的图层添加一个蒙版并移动它。

这将改变`extent_hint`，它包围了图像的所有非零 alpha 区域。

in_data>extent_hint "是这两个矩形(合成和遮罩)的交点，每当它们发生变化时就会改变。

在调整大小和原点移动之前，在原始输入层的坐标空间中计算范围矩形，以简化设置了[PF_OutFlag_PIX_INDEPENDENT](PF_OutData.html) 的效果中输入和输出范围的矩形交集。

为了得到输出缓冲区坐标系中的输出范围，用`PF_InData->output_origin_x`和`y`字段抵消`extent_hint`。

在计算输出尺寸时要考虑到降采样；用户必须能够以全分辨率渲染。

如果输出缓冲区超过 30,000 乘以 30,000，请将其夹紧，并考虑显示一个警告对话框。

一旦你的代码表现正确，启用缓存，看看效果需要重新渲染的频率。

考虑一下水滴阴影；用户经常将静态水滴阴影应用于静止的图像。

`output>extent_hint`被忽略了，所以缓存被更频繁地使用。

对于缓冲区扩大的效果，在[PF_Cmd_FRAME_SETUP](command-selectors.html)期间，将`output>extent_hint`与你的插件的变换边界相交，并相应地设置尺寸。

## Now with 20% More Pixels!

从 6.0 开始，传递的 extent_hints 比图层本身大 20%，以帮助我们做出预测性的渲染决定。

许多效果都是 "轻轻地 "扩大缓冲区，After Effects 经常在以后使用这些提示矩形。

## Point Controls And Buffer Expansion

在[PF_Cmd_FRAME_SETUP](command-selectors.html)期间，通过设置`output_origin_x/y`在`PF_InData`中的设置，扩展输出缓冲区的效果将原层的左上角定位。

这个偏移会在`pre_effect_source_origin_x/y`中报告给后续效果。点的参数会根据这个偏移自动调整。

应用一个缓冲区扩展器，如高斯模糊或 Resizer SDK 样本，在你的效果之前，并使用一个大的调整值。

如果你的效果没有正确处理`pre_effect_source_origin_x/y`，打开和关闭模糊会使输出的位置移动。

所有的点参数值(在任何时候)都有由`pre_effect_source_origin_x/y`描述的移位值。对于大多数效果来说，这都是透明的。

然而，如果缓冲区的扩展随着时间的推移而变化(如动画的模糊量)，原点的移动将移动非动画的点。

在设计帧间缓存点参数值的效果时要考虑到这一点。
